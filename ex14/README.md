# 实验14：生物反应器产率BP神经网络建模

## 实验目的

使用BP神经网络对生物反应器的产率百分比进行建模，根据温度、叶轮转速、持续时间以及反应器是否配备挡板等输入变量，预测产率百分比。

## 实验原理

1. **工业过程建模需求**：工业过程（如化工反应过程）通常具有非线性、时变、多变量耦合等特性，传统机理建模难度大，而数据驱动建模（如神经网络建模）通过挖掘历史运行数据中的规律，可高效构建过程模型。

2. **BP神经网络建模原理**：以工业过程的输入变量（如控制量、扰动变量）为网络输入，输出变量（如被控量）为网络输出，通过历史数据训练BP神经网络，使网络学习输入与输出之间的映射关系，构建过程模型。

3. **模型精度评估指标**：对于连续型输出的工业过程模型，常用均方根误差（RMSE）、平均绝对百分比误差（MAPE）评估模型精度，RMSE越小、MAPE越接近0，模型预测精度越高。

## 实验步骤

1. **数据采集与预处理**
   - 数据清洗：使用3σ准则删除异常值
   - 数据归一化：将输入、输出数据归一化到[0,1]区间
   - 数据划分：训练集80%，测试集20%

2. **BP神经网络模型构建**
   - 输入层：4个神经元（温度、持续时间、叶轮转速、挡板配置）
   - 隐藏层：2层（64个神经元、32个神经元），使用ReLU激活函数
   - 输出层：1个神经元（产率百分比），使用Linear激活函数

3. **模型训练与验证**
   - 优化器：Adam（学习率0.001）
   - 损失函数：均方误差（MSE）
   - 评估指标：RMSE、MAPE
   - 早停法：当验证集RMSE连续5个epoch不下降时停止训练

4. **模型测试与精度分析**
   - 计算测试集的RMSE和MAPE
   - 绘制"真实输出-预测输出"对比曲线
   - 绘制"预测误差"曲线
   - 绘制真实值vs预测值散点图

## 文件说明

- `bioreactor_bp_modeling.py`: 主程序文件，包含完整的数据预处理、模型构建、训练和评估流程
- `需求文档.md`: 实验需求文档
- `results/`: 结果输出目录（运行程序后自动创建）
  - `training_curves.png`: 训练曲线
  - `test_prediction_comparison.png`: 测试集预测对比图
  - `test_error_curve.png`: 测试集误差曲线
  - `test_scatter_comparison.png`: 测试集散点对比图

## 运行方法

### 环境要求

```bash
pip install torch pandas numpy matplotlib seaborn scikit-learn
```

### 运行程序

```bash
cd ex14
python bioreactor_bp_modeling.py
```

## 数据文件

数据文件位于：`data/exp14_data_bioreactor-yields.csv`

数据包含以下字段：
- `temperature`: 温度
- `duration`: 持续时间
- `speed`: 叶轮转速
- `baffles`: 是否配备挡板（Yes/No）
- `yield`: 产率百分比（目标变量）

## 模型结构

```
输入层 (4) → 隐藏层1 (64, ReLU) → 隐藏层2 (32, ReLU) → 输出层 (1, Linear)
```

## 评估指标

- **RMSE (均方根误差)**: 衡量预测值与真实值之间的差异，越小越好
- **MAPE (平均绝对百分比误差)**: 衡量预测误差的百分比，越接近0越好

## 实验结果

程序运行后会输出：
1. 数据预处理信息（数据清洗、归一化、划分）
2. 模型结构信息
3. 训练过程信息（训练损失、验证损失）
4. 模型性能指标（训练集、验证集、测试集的RMSE和MAPE）
5. 可视化图表（保存在results目录）

## 实验总结

### BP神经网络在工业过程建模中的优势

- 能够学习非线性映射关系
- 对多变量耦合关系有良好的建模能力
- 训练速度快，易于实现

### 局限性

- 需要大量历史数据
- 模型可解释性较差
- 对数据质量要求较高

### 建模关键步骤

1. 数据清洗：使用3σ准则删除异常值
2. 数据归一化：将数据归一化到[0,1]区间
3. 网络结构设计：通过试错法确定隐藏层神经元数量
4. 早停法：防止过拟合，提高模型泛化能力
5. 模型评估：使用RMSE和MAPE评估模型精度

