# LDPE生产过程故障诊断实验

## 实验简介

本实验基于主成分分析（PCA）和偏最小二乘（PLS）方法，对LDPE（低密度聚乙烯）生产过程进行故障诊断。通过构建正常工况的统计模型，利用T²统计量、SPE统计量和PRESS值检测故障，并通过贡献图分析实现故障隔离和溯源。

## 实验原理

### （一）PCA故障诊断原理

主成分分析（PCA）通过对高维过程变量进行线性变换，提取累计方差贡献率较高的主成分（PCs），构建正常工况的统计模型。利用T²统计量（衡量样本与模型的整体偏离程度）和SPE统计量（残差平方和，衡量未被主成分解释的变异）作为故障检测指标：当样本的T²或SPE值超出99%置信水平的控制限时，判定为故障。通过贡献图分析各变量对统计量超标的贡献度，实现故障隔离。

### （二）PLS故障诊断原理

偏最小二乘（PLS）同时考虑过程变量（X）与质量变量（Y）的相关性，构建X→Y的回归模型。通过计算预测误差平方和（PRESS）检测故障：故障样本会因过程波动导致质量变量预测值与实际值偏差增大，PRESS超出控制限即判定为故障。结合载荷矩阵可分析过程变量与质量变量的关联，追溯故障对产品质量的影响路径。

## 数据集说明

| 数据特征 | 具体内容 |
|---------|---------|
| 变量构成 | 14个过程变量（温度、压力、进料流量、催化剂浓度等）+ 5个质量变量（密度、熔融指数等）|
| 数据规模 | 54个观测值：前50个为正常工况（共因运行），后4个为故障工况（两区域乙烯进料杂质升高）|
| 数据性质 | 模拟串联管状反应堆LDPE生产过程数据，变量间存在强耦合关系 |
| 数据文件 | `data/exp16_data_LDPE.csv` |

### 过程变量（14个）
- Tin, Tmax1, Tout1, Tmax2, Tout2: 温度相关变量
- Tcin1, Tcin2: 冷却温度
- z1, z2: 催化剂浓度
- Fi1, Fi2: 进料流量
- Fs1, Fs2: 流量相关
- Press: 压力

### 质量变量（5个）
- Conv: 转化率
- Mn: 数均分子量
- Mw: 重均分子量
- LCB: 长链支化度
- SCB: 短链支化度

## 实验步骤

### （一）数据预处理（必做步骤）

1. **数据加载**：读取`data/exp16_data_LDPE.csv`文件，分离正常样本（前50行）和故障样本（后4行），分别提取过程变量X和质量变量Y。

2. **数据标准化**：对正常样本的X和Y分别进行标准化处理（均值=0，方差=1），消除量纲差异。

3. **数据验证**：检查标准化后的数据是否存在异常值（如NaN、无穷大），若有需通过插值或删除处理。

### （二）PCA故障诊断实验（必做）

1. **正常模型训练**：
   - 基于标准化后的正常样本过程变量X_normal_std，构建PCA模型，保留累计方差贡献率≥85%的主成分。
   - 计算T²控制限（基于F分布，置信水平99%）和SPE控制限（基于卡方分布，置信水平99%）。

2. **故障检测**：
   - 将标准化后的故障样本过程变量X_fault_std代入PCA模型，计算每个故障样本的T²和SPE值。
   - 对比故障样本的T²、SPE值与控制限，记录是否超出阈值，统计故障检测率。

3. **故障隔离**：
   - 绘制故障样本的T²贡献图和SPE贡献图，识别对统计量超标贡献最大的前3个过程变量。

4. **结果可视化**：
   - 绘制正常样本与故障样本的T²-SPE散点图，标注控制限，直观展示故障样本的偏离情况。

### （三）PLS故障诊断实验（选做实验）

1. **正常模型训练**：
   - 基于标准化后的正常样本X_normal_std和Y_normal_std，构建PLS回归模型，通过交叉验证（5折）确定最优主成分个数。
   - 计算PRESS控制限（置信水平99%），基于正常样本的预测误差分布确定阈值。

2. **故障检测**：
   - 将X_fault_std代入PLS模型，预测故障样本的质量变量Y_pred，计算PRESS值（PRESS = Σ(Y_fault - Y_pred)²）。
   - 对比PRESS值与控制限，判定故障是否被检测到。

3. **故障溯源**：
   - 分析PLS载荷矩阵，找出与质量变量（如密度）相关性最强的前3个过程变量，结合故障机理分析其合理性。

## 使用方法

### 环境要求

```bash
pip install numpy pandas matplotlib seaborn scikit-learn scipy
```

### 运行代码

```bash
cd ex15
python ldpe_fault_diagnosis.py
```

### 输出结果

代码运行后会在`results/`目录下生成以下可视化结果：

1. **pca_t2_spe_scatter.png**: PCA T²-SPE散点图
   - 展示正常样本和故障样本在T²-SPE空间中的分布
   - 标注T²和SPE控制限

2. **pca_contribution_plot.png**: PCA贡献图
   - 展示故障样本的T²和SPE贡献度
   - 识别对故障贡献最大的过程变量

3. **pls_press_comparison.png**: PLS PRESS值对比图
   - 展示正常样本和故障样本的PRESS值
   - 标注PRESS控制限

4. **pls_loadings_heatmap.png**: PLS载荷矩阵热力图
   - 展示过程变量和质量变量在主成分空间中的载荷
   - 用于分析变量间的关联关系

## 实验结果

### PCA故障诊断结果

- **主成分数**: 6个（累计方差贡献率89.32%）
- **T²控制限**: 21.67（99%置信水平）
- **SPE控制限**: 5.87（99%置信水平）
- **故障检测率**:
  - T²检测率: 25.0% (1/4)
  - SPE检测率: 75.0% (3/4)
  - 综合检测率: 75.0% (3/4)

### PLS故障诊断结果

- **最优主成分数**: 5个（通过5折交叉验证确定）
- **PRESS控制限**: 0.98（99%置信水平）
- **故障检测率**: 100.0% (4/4)

### 故障隔离结果

根据贡献图分析，对故障贡献最大的过程变量主要是：
- **z2**（催化剂浓度2）：在所有故障样本中贡献最大
- **Tmax2**（最高温度2）：温度相关变量
- **Fi2**（进料流量2）：流量相关变量

这与故障机理（两区域乙烯进料杂质升高）相符，说明故障主要影响第二区域的温度和催化剂浓度。

## 代码结构

```
ldpe_fault_diagnosis.py
├── load_and_preprocess_data()      # 数据加载与预处理
├── calculate_t2_spe()              # 计算T²和SPE统计量
├── calculate_contribution()        # 计算贡献度
├── pca_fault_diagnosis()           # PCA故障诊断主函数
├── pls_fault_diagnosis()           # PLS故障诊断主函数
└── main()                          # 主程序入口
```

## 注意事项

1. 数据文件路径：确保`data/exp16_data_LDPE.csv`文件存在于正确的位置。
2. 标准化处理：使用正常样本的均值和标准差对故障样本进行标准化，保持一致性。
3. 控制限计算：T²控制限基于F分布，SPE控制限基于卡方分布，PRESS控制限基于百分位数。
4. 贡献图分析：仅对超出控制限的故障样本进行贡献图分析。

## 参考文献

1. Jackson, J. E. (1991). A User's Guide to Principal Components. Wiley.
2. Wold, S., et al. (2001). PLS-regression: a basic tool of chemometrics. Chemometrics and Intelligent Laboratory Systems, 58(2), 109-130.
3. Qin, S. J. (2003). Statistical process monitoring: basics and beyond. Journal of Chemometrics, 17(8-9), 480-502.

